<!DOCTYPE html>
<html>
<head>
<style>

body 
{
  font-family: 'Trebuchet MS', sans-serif;
}

/* https://www.w3schools.com/css/css3_gradients.asp */
#grad1 
{
 /* height: 200px;*/
  background-color: #F0FFFF; /* For browsers that do not support gradients */
  /* background-image: linear-gradient(to bottom right, rgba(230,240,255,1), rgba(255,220,255,1) );*/
  background-image: linear-gradient(to bottom right, rgba(235,240,255,1), rgba(255,255,200,1) );
  border-width:3px;
  border-style:solid;
  border-color:#287EC7;
  padding:6px;  /* gap inside main border */
}

.textInputField
{
  background-color: #ccFFFF;
  color: #000070;
  font-size: 16px;
  width: 60px;
  padding: 0px 0px 0px 0px;  /*top.right,bottom,left only internal space*/
  margin:  0px 0px 0px 10px;
}

td
{
	font-size: 13px; color:rgb(0,0,50);
}

.top, .middle, .bottom 
{    
      padding: 0px 0px 10px 0px; /*.right,bottom, left: see https://www.w3schools.com/cssref/pr_padding.php  */
}
</style>

<link href='https://fonts.googleapis.com/css?family=Courgette' rel='stylesheet'>

</head>
<body>
<form id="grad1">


<!-- T i t l e -->
<div class="top">
<span style="margin:auto; font-family:'Courgette'; display:table;
 letter-spacing: 1.5px; padding-bottom: 0px; font-size: 17px; color:rgb(80,0,120);">Bug Buddy V1.0</span>
</div>

<table>
<tr>
<td>  <!-- R e q ' d   O / P   W a t t a g e -->
<label for ="wattsNeeded">Required O/P Wattage</label> 
</td>
<td>
<input type="text" class="textInputField" 									id="wattsNeeded" oninput="calculate(this)" value="85">
</td>

<tr>
<td>  <!-- C o i l   T e m p -->
<label for "tempHot">Coil Temperature</label>

<select id = "tempUnitsSelect" onchange = "calculate(this)" >
<option selected='selected'> &nbsp°C&nbsp </option>
<option> &nbsp°F&nbsp </option>
</select>
</td>

<td>
<!-- <input type="text" class="textInputField" style="color:#FF0000; width:100;" id="tempHot"  oninput="calculate(this)" value="160"> -->
<input type="text" class="textInputField"  id="tempHot"  oninput="calculate(this)" value="190">
</td>


<tr>
<td>
<label for "tcr">TCR</label> <!-- T C R -->
<select id = "TCRMaterial" onchange = "calculate(this)" >
<option selected='selected'> &nbspSS304&nbsp </option>
<option> &nbspSS316L&nbsp </option>
<option> &nbspNichrome NI80&nbsp </option>
<option> &nbspKanthal A1&nbsp </option>
</select>
</td>
<td>
<input type="text" class="textInputField" 									id="TCR" oninput="calculate(this)" value="105">
</td>

<tr>
<td> <!-- W a t t s   t o   S e t -->
<label for "watts2Set">Watts to set on mod</label>
</td>
<td><input type="text" class="textInputField" 									id="watts2Set" oninput="calculate(this)" value="100">
</td>
</table>
</form>

<!-- ------------------------------------------------------------------------------------ -->

<script>
const ambientTempC = 20.0;

// Declare "text"s
WoutField		= document.getElementById("wattsNeeded"); 
TempHotField 	= document.getElementById("tempHot");
TCRField 		= document.getElementById("TCR");
watts2SetField 	= document.getElementById("watts2Set");

// Declare "select"s i.e. dropdowns
TCRMaterialDropdown = document.getElementById("TCRMaterial");
tempUnitsSelectDropdown = document.getElementById("tempUnitsSelect");

initialise();

/** 	C A L C U L A T E ( )    */ 
function calculate(source)
{
	if(source==tempUnitsSelectDropdown)
	{
		let selIndex  =	tempUnitsSelectDropdown.selectedIndex; //0 for C, 1 for F
		if (selIndex==0)//change from °F to °C
		{
			TempHotField.value=DegF2C(TempHotField.value);
		}
		else if (selIndex==1) //change from °C to °F
		{
			TempHotField.value=DegC2F(TempHotField.value);
		}
		return;  //only changing from C to F and vice versa
	}
	
	else if (source==TCRMaterialDropdown)
	{
		resetTCRMaterialDropdownTexts();
		let selIndex  =	TCRMaterialDropdown.selectedIndex;
		//0=SS304 1=SS316, 2=Ni80; 3=A1
		switch(selIndex)
		{
			case 0:   TCRField.value= "105"; tcrVal=105; break;
			case 1:   TCRField.value= "95";  tcrVal=95;  break;
			case 2:   TCRField.value= "12";  tcrVal=12;  break;
			case 3:   TCRField.value= "0";   tcrVal=0;	 break;
		}
		//source=WoutField; //to kiddums it into carrying on with calcing as if requird watts out had changed
	}

	if (source==TCRField)
	{   
		if(TCRField.value.length==0) { resetTCRMaterialDropdownTexts();}
		else //set dropdown box
		{ 
			TCRMaterialDropdown.options[TCRMaterialDropdown.selectedIndex].text=TCRField.value;
		}
		tcrVal = parseInt(TCRField.value);
	}
	
	else if (source==WoutField) 	
	{
		if (!onlyDigits(WoutField.value))
		{
			WoutField.value = WoutField.value.substring(0, WoutField.value.length - 1);	
		}
		wOutVal = WoutField.value;	
	}
	else if (source==TempHotField)  
	{
		tempHotValC = parseFloat(TempHotField.value);
		if (tempUnitsSelectDropdown.selectedIndex==1) //0 for C, 1 for F
		{
			tempHotValC= DegF2C(tempHotValC);
		}		
	}
	else if (source==watts2SetField) 
	{
		watts2SetVal  = parseFloat(watts2SetField.value);
	}
	//by here, all values should be entered into the "class attributes"
	
	if (source==WoutField || source==TCRField || source==TempHotField) //usually we're typing in the Watts out needed field
	{
		watts2SetVal = (1.0 + ((tcrVal / 100000.0) * (tempHotValC-ambientTempC))) * wOutVal ; 
	}
	 else if (source==watts2SetField)
	{
		//wOutVal = watts2SetVal/(1 + ((tcrVal / 100000.0) * (tempHotValC-ambientTempC)));
		wOutVal = "" + (watts2SetVal/(1 + ((tcrVal / 100000.0) * (tempHotValC-ambientTempC))));
	}
	
	
	displayAll();
}

 
/**
Watts set =  (1+(TCR *∆t)) Wout
Watts out =   Watts set / (1+(TCR *∆t))
*/

function onlyDigits(s) 
{ 
	s=s.trim();
	for (let i = s.length - 1; i >= 0; i--) {
    const d = s.charCodeAt(i);
    if ((d!=46) && (d < 48 || d > 57)) {return false;} //46 is dec point
  }
  return true;
}

function DegC2F(degC)
{ 
	return (degC * 1.8) +32.0;
}

function DegF2C(degF) //°C = (°F - 32) ÷ (9/5)
{
    return (degF-32) / (9/5.0);
}

/**
re-labels texts of the TCR materials dropdowns with 
SS304, SS316L, Nichrome NI80 and Kanthal A1 
*/
function resetTCRMaterialDropdownTexts()
{
		TCRMaterialDropdown.options[0].text="SS304";
		TCRMaterialDropdown.options[1].text="SS316L";
		TCRMaterialDropdown.options[2].text="Nichrome NI80";
		TCRMaterialDropdown.options[3].text="Kanthal A1";	
}

function initialise()
{
wOutVal 	 = 20.0;
tempHotValC  = 190.0;
tcrVal		 = 105;
watts2SetVal = 0;  //don't care;   //done
TCRMaterialDropdown.selectedIndex = 0;
tempUnitsSelectDropdown.selectedIndex=0;
calculate(WoutField);
//displayAll();
}

function displayAll()
{
	if(!Number.isNaN(parseFloat(wOutVal)) && (onlyDigits(wOutVal)))	 	
	{WoutField.value=wOutVal;} 
	else {WoutField.value="";}
	
	if(!Number.isNaN(tempHotValC))
	{
		if( tempUnitsSelectDropdown.selectedIndex==1)
		{
			TempHotField.value = DegC2F(tempHotValC);
		}
		else {TempHotField.value = tempHotValC;}
	} 
	else{TempHotField.value="";}
	if(!Number.isNaN(tcrVal)){TCRField.value = tcrVal;} else {TCRField.value="";}
	
	//TCRField.value = tcrVal;
	if(!Number.isNaN(watts2SetVal)) {watts2SetField.value = watts2SetVal;} else {watts2SetField.value="";}
	
	
}



//WoutField.oninput = function()
 //{
//	if(!onlyDigits(WoutField.value)){WoutField.value = "-"; return;}
//	calculate();
 //}
</script>
</body>
</html>
